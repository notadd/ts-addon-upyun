{"version":3,"sources":["util/process.string.util.ts"],"names":[],"mappings":"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","file":"process.string.util.js","sourcesContent":["\nimport { Injectable, HttpException, Inject } from \"@nestjs/common\";\nimport { ImagePostProcessInfo, ImagePreProcessInfo } from \"../interface/file/image.process.info\";\nimport { Bucket } from \"../model/bucket.entity\";\nimport { KindUtil } from \"./kind.util\";\n\n/* URL做图处理字符串服务，可以根据请求体参数，拼接URL处理字符串 */\n@Injectable()\nexport class ProcessStringUtil {\n\n    private readonly gravity: Set<string> = new Set([ \"northwest\", \"north\", \"northeast\", \"west\", \"center\", \"east\", \"southwest\", \"south\", \"southeast\" ]);\n\n    constructor(\n        @Inject(KindUtil) private readonly kindUtil: KindUtil\n    ) {}\n\n    // 根据请求体参数生成处理字符串\n    makeImageProcessString(bucket: Bucket, imageProcessInfo: ImagePostProcessInfo | ImagePreProcessInfo): string {\n        // 分别获取缩放、裁剪、水印、旋转、圆角、高斯模糊、锐化、输出格式、图片质量、是否渐进显示、是否去除元信息等参数\n        let processString = \"\";\n        if (!imageProcessInfo || !bucket) {\n            return processString;\n        }\n        if (imageProcessInfo.resize) { processString += this.resizeString(imageProcessInfo.resize); }\n        if (imageProcessInfo.tailor) { processString += this.tailorString(imageProcessInfo.tailor); }\n        processString += this.watermarkString(imageProcessInfo.watermark, bucket);\n        if (imageProcessInfo.rotate) { processString += this.rotateString(imageProcessInfo.rotate); }\n        if (imageProcessInfo instanceof ImagePostProcessInfo) {\n            if (imageProcessInfo.blur) { processString += this.blurString(imageProcessInfo.blur); }\n            if (imageProcessInfo.sharpen || imageProcessInfo.format || imageProcessInfo.lossless || imageProcessInfo.quality || imageProcessInfo.progressive || imageProcessInfo.strip) {\n                processString += this.outputString(imageProcessInfo.sharpen, imageProcessInfo.format, imageProcessInfo.lossless, imageProcessInfo.quality, imageProcessInfo.progressive, imageProcessInfo.strip);\n            }\n        }\n        return processString;\n    }\n\n    /*生成缩放字符串\n      支持的缩放模式有：\n      scale：  指定比例，长宽等比例缩放\n      wscale:  指定比例，只缩放宽度，高度不变\n      hscale:  指定比例，只缩放高度，宽度不变\n      both：   指定宽高值，强制缩放不裁剪\n      fw：     指定宽度，等比缩放\n      fh：     指定高度，等比缩放\n      fp：     指定像素积，等比缩放\n      fwfh：   限定宽高最大值，宽高都不足时，不缩放，应该是让图片等比缩放到可以完全放进指定矩形的意思\n      fwfh2：  限定宽高最小值，宽高都大于指定值时，不缩放，应该是让图片等比缩放到可以完全包含指定矩形的意思\n      其中fw、fh、fp等，在有拍云中原意是限定宽度最大值，即只缩小不放大，加上/force/true的意思应该是指定而不是限定，需要验证\n      如果需要限定最大值功能，后面再加，因为七牛云大部分都是指定值\n    */\n    resizeString(resize: any) {\n        // 不存在直接返回，不抛出错误，进行下一步\n        if (!resize) {\n            return \"\";\n        }\n        // 缩放模式\n        const mode = resize.mode;\n        // 缩放数据\n        const info = resize.data;\n        if (mode === \"scale\") {\n            if (info.scale && Number.isInteger(info.scale) && info.scale >= 1 && info.scale <= 1000) {\n                // 这里的/force是为了保险\n                return \"/scale/\" + info.scale + \"/force/true\";\n            }\n            throw new HttpException(\"比例参数不正确\", 405);\n        } else if (mode === \"wscale\") {\n            if (info.wscale && Number.isInteger(info.wscale) && info.wscale >= 1 && info.wscale <= 1000) {\n                // 为了保险，经验证这里可以不加/force/true\n                return \"/wscale/\" + info.wscale + \"/force/true\";\n            }\n            throw new HttpException(\"宽度比例参数不正确\", 405);\n        } else if (mode === \"hscale\") {\n            if (info.hscale && Number.isInteger(info.hscale) && info.hscale >= 1 && info.hscale <= 1000) {\n                // 为了保险，经验证这里可以不加/force/true\n                return \"/hscale/\" + info.hscale + \"/force/true\";\n            }\n            throw new HttpException(\"高度比例参数不正确\", 405);\n        } else if (mode === \"both\") {\n            if (info.width && Number.isInteger(info.width) && info.height && Number.isInteger(info.height)) {\n                // 指定force强制缩放，否则宽高不足时会居中裁剪后缩放\n                // 经验证不加/force/true图片边缘处有变化，这个居中裁剪后缩放不是字面意思\n                return \"/both/\" + info.width + \"x\" + info.height + \"/force/true\";\n            }\n            throw new HttpException(\"宽高参数不正确\", 405);\n        }\n        else if (mode === \"fw\") {\n            if (info.width && Number.isInteger(info.width)) {\n                // 强制指定可以放大，经验证这个必须加上/force/true才能放大\n                return \"/fw/\" + info.width + \"/force/true\";\n            }\n            throw new HttpException(\"宽度参数不正确\", 405);\n        } else if (mode === \"fh\") {\n            if (info.height && Number.isInteger(info.height)) {\n                // 强制指定可以放大，经验证这个必须加上/force/true才能放大\n                return \"/fh/\" + info.height + \"/force/true\";\n            }\n            throw new HttpException(\"高度参数不正确\", 405);\n        } else if (mode === \"fp\") {\n            if (info.pixel && Number.isInteger(info.pixel) && info.pixel >= 1 && info.pixel <= 25000000) {\n                // 强制指定可以放大，经验证这个必须加上/force/true才能放大\n                return \"/fp/\" + info.pixel + \"/force/true\";\n            }\n            throw new HttpException(\"像素参数不正确\", 405);\n        } else if (mode === \"fwfh\") {\n            if (info.width && Number.isInteger(info.width) && info.height && Number.isInteger(info.height)) {\n                // 加上force，代表可以放大缩小，但是缩放后必须可以被指定矩形完全包含\n                return \"/fwfh/\" + info.width + \"x\" + info.height + \"/force/true\";\n            }\n            throw new HttpException(\"宽高参数不正确\", 405);\n        } else if (mode === \"fwfh2\") {\n            if (info.width && Number.isInteger(info.width) && info.height && Number.isInteger(info.height)) {\n                // 加上force，代表可以放大缩小，但是缩放后必须可以完全包含指定矩形\n                return \"/fwfh2/\" + info.width + \"x\" + info.height + \"/force/true\";\n            }\n            throw new HttpException(\"宽高参数不正确\", 405);\n        } else {\n            throw new HttpException(\"缩放模式不正确\", 405);\n        }\n    }\n\n    /* 生成裁剪字符串，可以在缩放之前或之后裁剪\n       暂定坐标都只能为整数，a为正向(即向东南/右下偏移)，s为负向(即向西北/左上偏移)\n       但是在七牛云中，可以使用-x来代表为指定宽度减去指定值，这里有歧义，七牛云的坐标不知道可不可以为负值，反正七牛云中没有a、s之说\n     */\n    tailorString(tailor: any) {\n        if (!tailor) {\n            return \"\";\n        }\n        const { isBefore, width, height, x, y, gravity } = tailor;\n        let str = \"\";\n        if (isBefore !== undefined && isBefore !== undefined && isBefore === true) {\n            str += \"/crop\";\n        } else if (isBefore !== undefined && isBefore !== undefined && isBefore === false) {\n            str += \"/clip\";\n        } else if (isBefore === undefined && isBefore === undefined) {\n            // 默认为缩放之后裁剪\n            str += \"/clip\";\n        } else {\n            throw new HttpException(\"裁剪顺序指定错误\", 405);\n        }\n\n        if (width && Number.isInteger(width) && height && Number.isInteger(height) && x && Number.isInteger(x) && y && Number.isInteger(y)) {\n            str += \"/\" + width + \"x\" + height;\n        } else {\n            throw new HttpException(\"裁剪宽高参数不正确\", 405);\n        }\n        if (x && Number.isInteger(x) && x >= 0) {\n            str += \"a\" + x;\n        } else if (x && Number.isInteger(x) && x < 0) {\n            str += \"s\" + x;\n        } else {\n            throw new HttpException(\"x参数不正确\", 405);\n        }\n        if (y && Number.isInteger(y) && y >= 0) {\n            str += \"a\" + y;\n        } else if (y && Number.isInteger(y) && y < 0) {\n            str += \"s\" + y;\n        } else {\n            throw new HttpException(\"y参数不正确\", 405);\n        }\n\n        if (gravity && this.gravity.has(gravity)) {\n            str += \"/gravity/\" + gravity;\n        } else if (!gravity) {\n            // 默认为西北角\n            str += \"/gravity/northwest\";\n        } else {\n            throw new HttpException(\"裁剪重心参数不正确\", 405);\n        }\n        return str;\n    }\n\n    /* 生成水印字符串\n       水印配置只有全局一个\n       默认情况下全局启用水印，所有图片都打水印\n       可以通过参数覆盖全局启用配置\n    */\n    watermarkString(watermark: boolean, bucket: Bucket) {\n        let enable: boolean;\n        if (watermark === true) {\n            enable = true;\n        } else if (watermark === false) {\n            enable = false;\n        } else if (watermark === undefined || watermark === undefined) {\n            if (bucket.imageConfig.watermarkEnable === 1) {\n                enable = true;\n            } else if (bucket.imageConfig.watermarkEnable === 0) {\n                enable = false;\n            } else {\n                enable = false;\n            }\n        } else {\n            throw new HttpException(\"水印参数不正确\", 405);\n        }\n        let str = \"\";\n        if (enable) {\n            if (bucket.imageConfig.watermarkSaveKey) {\n                str += \"/watermark/url/\" + Buffer.from(bucket.imageConfig.watermarkSaveKey).toString(\"base64\");\n            } else {\n                throw new HttpException(\"水印图片url不存在\", 405);\n            }\n\n            if (bucket.imageConfig.watermarkGravity && !this.gravity.has(bucket.imageConfig.watermarkGravity)) {\n                throw new HttpException(\"水印重心参数不正确\", 405);\n            } else {\n                str += \"/align/\" + bucket.imageConfig.watermarkGravity;\n            }\n\n            if ((bucket.imageConfig.watermarkX && !Number.isInteger(bucket.imageConfig.watermarkX)) || (bucket.imageConfig.watermarkY && !Number.isInteger(bucket.imageConfig.watermarkY))) {\n                throw new HttpException(\"偏移参数不正确\", 405);\n            } else if (!bucket.imageConfig.watermarkX && !bucket.imageConfig.watermarkY) {\n                str += \"/margin/20x20\";\n            } else if (!bucket.imageConfig.watermarkX && bucket.imageConfig.watermarkY) {\n                str += \"/margin/20x\" + bucket.imageConfig.watermarkY;\n            } else if (bucket.imageConfig.watermarkX && !bucket.imageConfig.watermarkY) {\n                str += \"/margin/\" + bucket.imageConfig.watermarkX + \"x20\";\n            } else {\n                str += \"/margin/\" + bucket.imageConfig.watermarkX + \"x\" + bucket.imageConfig.watermarkY;\n            }\n\n            if (bucket.imageConfig.watermarkOpacity && !Number.isInteger(bucket.imageConfig.watermarkOpacity)) {\n                throw new HttpException(\"透明度参数不正确\", 405);\n            } else if (!bucket.imageConfig.watermarkOpacity) {\n                // 默认为100，不用管\n            } else {\n                str += \"/opacity/\" + bucket.imageConfig.watermarkOpacity;\n            }\n\n            if (bucket.imageConfig.watermarkWs && Number.isInteger(bucket.imageConfig.watermarkWs) && bucket.imageConfig.watermarkWs >= 1 && bucket.imageConfig.watermarkWs <= 100) {\n                str += \"/percent/\" + bucket.imageConfig.watermarkWs;\n            } else if (!bucket.imageConfig.watermarkWs) {\n                // 默认为0，不用管\n            } else {\n                throw new HttpException(\"短边自适应参数不正确\", 405);\n            }\n        }\n        return str;\n    }\n\n    rotateString(rotate: number) {\n        if (!rotate) {\n            return \"\";\n        }\n        if (Number.isInteger(rotate)) {\n            return \"/rotate/\" + rotate;\n        } else {\n            throw new HttpException(\"旋转角度不正确\", 405);\n        }\n    }\n\n    blurString(blur: any) {\n        if (!blur) {\n            return \"\";\n        }\n        const { redius, sigma } = blur;\n        if (!redius || !Number.isInteger(redius) || redius < 0 || redius > 50) {\n            throw new HttpException(\"模糊半径不正确\", 405);\n        }\n        if (!sigma || !Number.isInteger(sigma)) {\n            throw new HttpException(\"标准差不正确\", 405);\n        }\n        return \"/gaussblur/\" + redius + \"x\" + sigma;\n    }\n\n    outputString(sharpen: boolean, format: string, lossless: boolean, quality: number, progressive: boolean, strip: boolean) {\n        let str = \"\";\n        if (sharpen === true) {\n            str += \"/unsharp/true\";\n        } else if (sharpen) {\n            throw new HttpException(\"锐化参数不正确\", 405);\n        } else {\n            // false或者不存在都不管\n        }\n        if (format && this.kindUtil.isImage(format)) {\n            str += \"/format/\" + format;\n        } else if (format && !this.kindUtil.isImage(format)) {\n            throw new HttpException(\"格式参数不正确\", 405);\n        } else {\n        }\n\n        if (lossless === true) {\n            str += \"/lossless/true\";\n        } else if (sharpen) {\n            throw new HttpException(\"无损参数不正确\", 405);\n        } else {\n            // false或者不存在都不管\n        }\n\n        if (quality && Number.isInteger(quality) && quality >= 1 && quality <= 99) {\n            str += \"/quality/\" + quality;\n        } else if (!quality) {\n        } else {\n            throw new HttpException(\"图片质量参数不正确\", 405);\n        }\n\n        if (progressive === true) {\n            str += \"/progressive/true\";\n        } else if (progressive) {\n            throw new HttpException(\"渐进参数不正确\", 405);\n        } else {\n            // false或者不存在都不管\n        }\n\n        if (strip === true) {\n            str += \"/strip/true\";\n        } else if (strip) {\n            throw new HttpException(\"去除元信息参数不正确\", 405);\n        } else {\n            // false或者不存在都不管\n        }\n        return str;\n    }\n}\n"]}